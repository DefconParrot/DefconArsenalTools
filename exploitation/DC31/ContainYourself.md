# ContainYourself

Category: Exploitation

Tags: Privilege Escalation, Windows Exploitation, security

Tool Presented at: Defcon 31

Author/presenter: [Daniel Avinoam](https://twitter.com/daniel_avinoam)

## Tool Description

![Daniel Avinoam - Contain Yourself Staying Undetected Using the Windows Container Isolation Framework pdf](https://github.com/DefconParrot/DefconArsenalTools/assets/30528167/d32b808b-30ec-483b-80c1-abaec8dc57c4)

A PoC of the ContainYourself research presented in DEFCON 31, which abuses the Windows containers framework to bypass EDRs.

The use of containers became an integral part of any resource-efficient and secure environment. Starting from Windows Server 2016, Microsoft released its version of this solution called Windows Containers, which offers either a process or Hyper-V isolation modes.
In both cases, an efficient file system separation should be provided. On one hand, each container should be able to access system files and write changes that will not affect the host. On the other, copying the entire main volume on each container launch will be storage-inefficient and not practical.

In this presentation, we will cover the basics of windows containers, break down its file system isolation framework, reverse-engineer its main mini-filter driver, and see how it can be utilized and manipulated by an actor to bypass EDR products in multiple domains. Eventually, we will provide an open-source tool based on these findings.

This technology caught my attention for several reasons:

- Containers and virtualization solutions are everywhere, and their internal workings are not well documented.
- Actors often search for ways to escape containers. The idea of intentionally entering into one in order to evade security products has yet to be explored.
- This framework doesn't require any prerequisites and comes as default in every modern Windows image! (the part which we will abuse, at least).

## Reference Links:

- Link to Tool⚙️ => https://github.com/deepinstinct/ContainYourself
- Link to slide✍️ => https://media.defcon.org/DEF%20CON%2031/DEF%20CON%2031%20presentations/Daniel%20Avinoam%20-%20Contain%20Yourself%20Staying%20Undetected%20Using%20the%20Windows%20Container%20Isolation%20Framework.pdf
- Link to Talk(presentation)📺 => https://youtu.be/Cm-zFx6hwzk

## Author Description

As a security researcher at Deep Instinct, _Daniel develops_ and researches new defense capabilities.After serving for several years in the advanced technological cyber unit under the Israeli Air Force, Daniel has experience in the defensive side of cyber warfare, including forensics, incident response, development, reverse engineering, and research.

## Author's Social Links:

- [Twitter: Daniel Avinoam](https://twitter.com/daniel_avinoam)
- [Website: Deep Instinct](https://www.deepinstinct.com/)
